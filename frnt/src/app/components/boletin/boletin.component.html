<div class="boletin-container">
  <div class="boletin-header">
    <h1>Bolet√≠n de Precios</h1>
    
    <!-- Bot√≥n para gestionar productos (solo para managers) -->
    <button 
      *ngIf="canManageProducts()" 
      class="btn btn-primary toggle-btn"
      (click)="toggleProductManagement()"
    >
      {{ showProductManagement ? 'Ver Boletines' : 'Gestionar Productos' }}
    </button>
  </div>

  <!-- Mensajes de estado -->
  <div class="messages" *ngIf="errorMessage || successMessage">
    <div class="error-message" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>
    <div class="success-message" *ngIf="successMessage">
      {{ successMessage }}
    </div>
  </div>

  <!-- Gesti√≥n de Productos (solo para managers) -->
  <div class="product-management" *ngIf="showProductManagement && canManageProducts()">
    <!-- Formulario de producto -->
    <div class="form-section">
      <h2>{{ isEditing ? 'Editar Producto' : 'Crear Nuevo Producto' }}</h2>
      
      <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="product-form">
        <div class="form-row">
          <!-- Nombre -->
          <div class="form-group">
            <label for="name">Nombre del Producto *</label>
            <input
              type="text"
              id="name"
              formControlName="name"
              placeholder="Ingrese el nombre del producto"
              [class.error]="hasError('name')"
            />
            <span class="error-message" *ngIf="hasError('name')">
              {{ getErrorMessage('name') }}
            </span>
          </div>

          <!-- Categor√≠a -->
          <div class="form-group">
            <label for="category">Categor√≠a *</label>
            <select
              id="category"
              formControlName="category"
              [class.error]="hasError('category')"
            >
              <option value="">Seleccione una categor√≠a</option>
              <option value="Verduras">Verduras</option>
              <option value="Tub√©rculos">Tub√©rculos</option>
              <option value="Frutas">Frutas</option>
              <option value="C√°rnicos">C√°rnicos</option>
              <option value="L√°cteos">L√°cteos</option>
            </select>
            <span class="error-message" *ngIf="hasError('category')">
              {{ getErrorMessage('category') }}
            </span>
          </div>
        </div>

        <div class="form-row">
          <!-- Descripci√≥n -->
          <div class="form-group">
            <label for="description">Descripci√≥n</label>
            <textarea
              id="description"
              formControlName="description"
              placeholder="Descripci√≥n del producto (opcional)"
              rows="3"
              [class.error]="hasError('description')"
            ></textarea>
            <span class="error-message" *ngIf="hasError('description')">
              {{ getErrorMessage('description') }}
            </span>
          </div>

          <!-- Unidad -->
          <div class="form-group">
            <label for="unit">Unidad *</label>
            <select
              id="unit"
              formControlName="unit"
              [class.error]="hasError('unit')"
            >
              <option value="kg">Kilogramo (kg)</option>
              <option value="g">Gramo (g)</option>
              <option value="lb">Libra (lb)</option>
              <option value="unidad">Unidad</option>
              <option value="litro">Litro</option>
              <option value="ml">Mililitro (ml)</option>
              <option value="docena">Docena</option>
            </select>
            <span class="error-message" *ngIf="hasError('unit')">
              {{ getErrorMessage('unit') }}
            </span>
          </div>
        </div>

        <div class="form-row">
          <!-- Precio -->
          <div class="form-group">
            <label for="price">Precio *</label>
            <input
              type="number"
              id="price"
              formControlName="price"
              placeholder="0"
              min="0.01"
              step="0.01"
              [class.error]="hasError('price')"
            />
            <span class="error-message" *ngIf="hasError('price')">
              {{ getErrorMessage('price') }}
            </span>
          </div>

          <!-- Disponible -->
          <div class="form-group">
            <label class="checkbox-label">
              <input
                type="checkbox"
                formControlName="isAvailable"
              />
              <span>Producto disponible</span>
            </label>
          </div>
        </div>

        <!-- Botones -->
        <div class="form-actions">
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="isLoading || productForm.invalid"
          >
            <span *ngIf="!isLoading">{{ isEditing ? 'Actualizar' : 'Crear' }} Producto</span>
            <span *ngIf="isLoading">Procesando...</span>
          </button>
          
          <button
            type="button"
            class="btn btn-secondary"
            (click)="resetForm()"
            [disabled]="isLoading"
          >
            Cancelar
          </button>
        </div>
      </form>
    </div>

    <!-- Lista de productos -->
    <div class="products-section">
      <div class="section-header">
        <h2>Productos Existentes</h2>
        
        <!-- Filtro por categor√≠a -->
        <div class="category-filter">
          <label for="categoryFilter">Filtrar por categor√≠a:</label>
          <select id="categoryFilter" (change)="filterByCategory($event)">
            <option value="">Todas las categor√≠as</option>
            <option *ngFor="let category of categories" [value]="category">
              {{ category }}
            </option>
          </select>
        </div>
      </div>
      
      <div class="loading" *ngIf="isLoading">
        <p>Cargando productos...</p>
      </div>

      <div class="products-table" *ngIf="!isLoading && products.length > 0">
        <table>
          <thead>
            <tr>
              <th>Producto</th>
              <th>Categor√≠a</th>
              <th>Unidad</th>
              <th>Precio</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let product of products">
              <td>
                <div class="product-info">
                  <strong>{{ product.name }}</strong>
                  <small *ngIf="product.description">{{ product.description }}</small>
                </div>
              </td>
              <td>
                <span class="category-badge">{{ product.category }}</span>
              </td>
              <td>{{ product.unit }}</td>
              <td>
                <div class="price-container">
                  <span class="price">{{ formatPrice(product.price) }}</span>
                  <input
                    type="number"
                    [value]="product.price"
                    (blur)="updatePrice(product, $event)"
                    class="price-input"
                    min="0.01"
                    step="0.01"
                  />
                </div>
              </td>
              <td>
                <span class="status-badge" [class.available]="product.isAvailable" [class.unavailable]="!product.isAvailable">
                  {{ product.isAvailable ? 'Disponible' : 'No disponible' }}
                </span>
              </td>
              <td class="actions">
                <button
                  class="btn btn-sm btn-edit"
                  (click)="editProduct(product)"
                  [disabled]="isLoading"
                >
                  Editar
                </button>
                <button
                  class="btn btn-sm btn-delete"
                  (click)="deleteProduct(product)"
                  [disabled]="isLoading"
                >
                  Eliminar
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="no-products" *ngIf="!isLoading && products.length === 0">
        <p>No hay productos registrados.</p>
      </div>
    </div>
  </div>

  <!-- Vista de Boletines (para todos los usuarios) -->
  <div class="bulletin-section" *ngIf="!showProductManagement">
    <div class="bulletin-header">
      <h2>Bolet√≠n de Precios</h2>
      
      <div class="bulletin-controls">
        <!-- Filtro por categor√≠a para boletines -->
        <div class="bulletin-filter">
          <label for="bulletinCategoryFilter">Filtrar por categor√≠a:</label>
          <select id="bulletinCategoryFilter" (change)="filterBulletinByCategory($event)">
            <option value="">Todas las categor√≠as</option>
            <option *ngFor="let category of categories" [value]="category">
              {{ category }}
            </option>
          </select>
        </div>
        
        <!-- Bot√≥n de generar PDF -->
        <button 
          class="btn btn-pdf"
          (click)="generatePDF()"
          [disabled]="isLoading || products.length === 0"
        >
          <span *ngIf="!isLoading">üìÑ Generar PDF</span>
          <span *ngIf="isLoading">‚è≥ Generando...</span>
        </button>
      </div>
    </div>
    
    <div class="loading" *ngIf="isLoading">
      <p>Cargando productos...</p>
    </div>

    <div class="bulletin-list" *ngIf="!isLoading && boletin.length > 0">
      <div class="bulletin-item" *ngFor="let item of boletin">
        <div class="bulletin-category-header">
          <h3>{{ item.title }}</h3>
          <span class="product-count">{{ item.products.length }} productos</span>
        </div>
        <p class="bulletin-date">Actualizado: {{ item.publicationDate | date:'short' }}</p>
        
        <div class="products-grid">
          <div class="product-card" *ngFor="let product of item.products">
            <div class="product-name">
              <strong>{{ product.name }}</strong>
              <small *ngIf="product.description">{{ product.description }}</small>
            </div>
            <div class="product-details">
              <span class="product-unit">{{ product.unit }}</span>
              <span class="product-price">{{ formatPrice(product.price) }}</span>
            </div>
            <div class="product-status">
              <span class="status-badge" [class.available]="product.isAvailable" [class.unavailable]="!product.isAvailable">
                {{ product.isAvailable ? 'Disponible' : 'No disponible' }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="no-bulletins" *ngIf="!isLoading && boletin.length === 0">
      <div class="empty-state">
        <h3>No hay productos disponibles</h3>
        <p>Los productos aparecer√°n aqu√≠ una vez que sean agregados por un manager.</p>
        <div class="empty-icon">üìã</div>
      </div>
    </div>
  </div>
</div>