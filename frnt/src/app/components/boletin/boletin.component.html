<div class="page-container">
  <div class="page-header">
    <h2>üì∞ Bolet√≠n de Precios</h2>
    <p class="subtitle">Gestiona los boletines de precios diarios</p>
    <button 
      *ngIf="canCreateBulletin" 
      class="btn btn-primary" 
      (click)="toggleCreateForm()"
      [disabled]="showCreateForm && !isEditing">
      {{ showCreateForm && !isEditing ? 'Cancelar' : '+ Nuevo Bolet√≠n' }}
    </button>
    <div *ngIf="!canCreateBulletin" class="permission-notice">
      <p>‚ÑπÔ∏è Solo el administrador de la plaza puede crear y gestionar boletines</p>
    </div>
  </div>

  <!-- Formulario de creaci√≥n/edici√≥n -->
  <div class="content-card" *ngIf="showCreateForm">
    <h3>{{ isEditing ? 'Editar Bolet√≠n' : 'Crear Nuevo Bolet√≠n' }}</h3>
    
    <form [formGroup]="bulletinForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="title">T√≠tulo del Bolet√≠n</label>
        <input 
          type="text" 
          id="title" 
          formControlName="title" 
          class="form-control"
          [class.error]="hasError('title')"
          placeholder="Ej: Precios del d√≠a - 15 de Enero">
        <div class="error-message" *ngIf="hasError('title')">
          {{ getErrorMessage('title') }}
        </div>
      </div>

      <div class="form-group">
        <label for="publicationDate">Fecha de Publicaci√≥n</label>
        <input 
          type="date" 
          id="publicationDate" 
          formControlName="publicationDate" 
          class="form-control">
      </div>

      <div class="form-group">
        <label for="file">Archivo Adjunto *</label>
        <input 
          type="file" 
          id="file" 
          (change)="onFileSelected($event)"
          class="form-control"
          [class.error]="hasError('file')"
          required
          accept=".pdf,.doc,.docx,.xls,.xlsx,.txt,.jpg,.jpeg,.png,.gif">
        <small class="form-text text-muted">
          Tipos permitidos: PDF, DOC, DOCX, XLS, XLSX, TXT, JPG, PNG, GIF (m√°ximo 10MB)
        </small>
        <div class="error-message" *ngIf="hasError('file')">
          {{ getErrorMessage('file') }}
        </div>
        
        <div *ngIf="selectedFile" class="file-preview">
          <div class="file-info">
            <span class="file-icon">üìé</span>
            <div class="file-details">
              <div class="file-name">{{ selectedFile.name }}</div>
              <div class="file-size">{{ formatFileSize(selectedFile.size) }}</div>
            </div>
            <button type="button" class="btn btn-sm btn-danger" (click)="removeFile()">
              ‚úï
            </button>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" [disabled]="bulletinForm.invalid">
          {{ isEditing ? 'Actualizar Bolet√≠n' : 'Publicar Bolet√≠n' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="resetForm()">
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <!-- Lista de boletines -->
  <div class="content-card" *ngIf="bulletins.length > 0; else noData">
    <h3>Boletines del D√≠a</h3>
    
    <div class="bulletin-list">
      <div class="bulletin-item" *ngFor="let bulletin of bulletins">
        <div class="bulletin-header">
          <h4>{{ bulletin.title }}</h4>
          <div class="bulletin-actions" *ngIf="canCreateBulletin">
            <button class="btn btn-sm btn-outline" (click)="startEdit(bulletin)">
              ‚úèÔ∏è Editar
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteBulletin(bulletin.id)">
              üóëÔ∏è Eliminar
            </button>
          </div>
        </div>
        
        <div class="bulletin-meta">
          <span class="meta-item">
            üìÖ {{ bulletin.publicationDate | date:'dd/MM/yyyy' }}
          </span>
          <span class="meta-item">
            üë§ {{ bulletin.createdByFullName }}
          </span>
          <span class="meta-item">
            üè¢ {{ bulletin.plazaName }}
          </span>
        </div>
        
        <div class="bulletin-content">
          <pre>{{ bulletin.content }}</pre>
        </div>
        
        <div *ngIf="bulletin.fileName" class="bulletin-attachment">
          <div class="attachment-info">
            <span class="attachment-icon">üìé</span>
            <div class="attachment-details">
              <div class="attachment-name">{{ bulletin.fileName }}</div>
              <div class="attachment-meta">
                <span class="attachment-type">{{ bulletin.fileType?.toUpperCase() }}</span>
                <span class="attachment-size" *ngIf="bulletin.fileSize">
                  ({{ formatFileSize(bulletin.fileSize) }})
                </span>
              </div>
            </div>
            <button class="btn btn-sm btn-outline" (click)="downloadFile(bulletin)">
              ‚¨áÔ∏è Descargar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template #noData>
    <div class="empty-state">
      <div class="empty-icon">üìã</div>
      <h3>No hay boletines disponibles</h3>
      <p>No se han publicado boletines para hoy</p>
      <button 
        *ngIf="canCreateBulletin" 
        class="btn btn-primary" 
        (click)="toggleCreateForm()">
        Crear Primer Bolet√≠n
      </button>
      <div *ngIf="!canCreateBulletin" class="permission-notice">
        <p>‚ÑπÔ∏è Contacta al administrador de la plaza para publicar boletines</p>
      </div>
    </div>
  </ng-template>
</div>
